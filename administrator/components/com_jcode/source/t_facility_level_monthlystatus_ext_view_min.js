var POMasterEntryform,savePOMasterEntryform,ResetPOMasterEntryform,POMasterEntryformWindow,dsPatientOverview,dsAdultRegimens,dsMasterStockData,dsArvData,ClosePOMasterEntryform,searchfield,searchfield_patientOverview,searchfield_adultRegimens,searchfield_paediatricRegimens,searchfield_OIsAndProphylaxis,searchfield_ArvData,recPatientOverview,gridAdultRegimens,gridArvData,tabArvdata,facilityId,dsFacility,dsMonth,dsYear,dsRegion,vTotalRec,facilityIndex,monthIndex,yearIndex,vFacilityId,vYearId,vMonthId,vFacility,vYear,vMonth,curDate,curMonth,prevMonth,nextMonth,curYear,prevYear,nextYear,vOpStock_A,vReceiveQty,vAdjustQty,vAdjustReason,vStockoutDays,vStockOutReasonId,vOrderQty=0,vClStock_A=0,vClStockSourceId,vDispenseQty=0,vClStock_C=0,vAMC=0,vAMC_C=0,vAmcChangeReasonId=0,vMOS=0,vMaxQty=0,vOrderQty=0,vActualQty=0,pActualQty=0,vARVDataId=0,pARVDataId,lmisStartMonth,lmisStartYear,initMonthId,initYearId,supplyFrom,invalidMsgCount=0,bShowMsgBox=0,bYesNoMsg=0,rIndex=-1,cIndex=-1,pItemGroupId,pReportId=0,vReportId=0,reportId=0,vBeforeLastMonthDispensed=0,vBeforeLastMonthDispensedDevisor=0,vLastMonthDispensed=0,vLastMonthDispensedDevisor=0,vDispenseQtyDevisor=0,v3MonthTotal=0,vDevisor=0,bSubmitted=0,bReadOnly=!0,dsAdjustReason,dsClStockSource,dsAmcChangeReason,dsOrderQtyChangeReason,pAdjustId,gItemGroupId=0,pStatusId=0,pFacilityCount=0,bClickButton=!1,gRowIndex=0,stockOutDays=0,stockOutReason="",minActQtyFactor=2,maxActQtyFactor=3,bPatient=0,gClosingAlert="",pMonthId=null,pYearId=null,pCountryId=null,pRegionId=null,pDistrictId=null,pOwnerTypeId=null,pItemGroupId=null,pFacilityId=null,oOpStock_A=0,oReceiveQty=0,oAdjustQty=0,oClStock_A=0,oDispenseQty=0,gRowIndex=0,start=0,tmpDistrictId=-1,selectedTab,jstore,CLM_ARVDATAID=0,CLM_FACILITYID=1,CLM_MONTHID=2,CLM_YEAR=3,CLM_ITEMGROUPID=4,CLM_ITEMNO=5,CLM_ITEMSL=6,CLM_ITEMNAME=7,CLM_OPSTOCK_C=8,CLM_OPSTOCK_A=9,CLM_RECEIVEQTY=10,CLM_DISPENSEQTY=11,CLM_LASTMONTHDISPENSED=12,CLM_BEFORELASTMONTHDISPENSED=13,CLM_ADJUSTQTY=14,CLM_ADJUSTID=15,CLM_STOCKOUTDAYS=16,CLM_STOCKOUTREASONID=17,CLM_CLSTOCK_C=18,CLM_CLSTOCK_A=19,CLM_CLSTOCKSOURCEID=20,CLM_AMC_C=21,CLM_AMC=22,CLM_AMCCHANGEREASONID=23,CLM_MOS=24,CLM_MAXQTY=25,CLM_ORDERQTY=26,CLM_ACTUALQTY=27,CLM_OUREASONID=28,CLM_USERID=29,CLM_FORMULATIONNAME=30;Ext.onReady(function(){function savePatientOverview(oGrid_event){var vCFMPOId=oGrid_event.record.data.CFMPOId,vTotalPatient=oGrid_event.record.data.TotalPatient;dsPatientOverview.commitChanges(),Ext.Ajax.request({waitMsg:"Please wait...",url:baseUrl+"t_facility_level_monthlystatus_ext_server.php",params:{action:"updatePatientOverview",cFMPOId:vCFMPOId,totalPatient:vTotalPatient,pFacilityId:pFacilityId,pMonthId:pMonthId,pYearId:pYearId,gItemGroupId:gItemGroupId,lang:lan},success:function(response){switch(eval(response.responseText),success){case 1:break;case 0:Ext.Msg.show({msg:error,icon:Ext.Msg.INFO,minWidth:300,buttons:Ext.Msg.OK,scope:this});break;default:Ext.Msg.show({msg:response.responseText,icon:Ext.Msg.INFO,minWidth:300,buttons:Ext.Msg.OK,scope:this})}}})}function saveAdultRegimens(oGrid_event){Ext.Ajax.request({waitMsg:"Please wait...",url:baseUrl+"t_facility_level_monthlystatus_ext_server.php",params:{action:"updateRegimenPatient",pCFMPatientStatusId:oGrid_event.record.data[oGrid_event.field+"_Id"],pPatients:oGrid_event.value,pItemGroupId:pItemGroupId,pFacilityId:pFacilityId,pMonthId:pMonthId,pYearId:pYearId,lang:lan},success:function(response){switch(eval(response.responseText),success){case 1:dsAdultRegimens.commitChanges();break;case 0:Ext.Msg.show({msg:error,icon:Ext.Msg.INFO,minWidth:300,buttons:Ext.Msg.OK,scope:this});break;default:Ext.Msg.show({msg:response.responseText,icon:Ext.Msg.INFO,minWidth:300,buttons:Ext.Msg.OK,scope:this})}}})}function isNorE(t){return parseInt(isNaN(t)||""==t?0:t)}function saveTheCell(t){switch(lastEditRc=this.lastEdit,rIndex=lastEditRc.row,cIndex=lastEditRc.col,vARVDataId=t.record.data.ARVDataId,vOpStock_C=isNorE(t.record.data.OpStock_A),vOpStock_A=isNorE(t.record.data.OpStock_A),vReceiveQty=isNorE(t.record.data.ReceiveQty),vDispenseQty=isNorE(t.record.data.DispenseQty),vAdjustQty=isNorE(t.record.data.AdjustQty),vAdjustReason=t.record.data.AdjustReason,vOUReasonId=t.record.data.OUReasonId,vStockoutDays=isNorE(t.record.data.StockoutDays),vStockOutReasonId=t.record.data.StockOutReasonId,vClStock_C=isNorE(t.record.data.ClStock_A),vClStock_A=isNorE(t.record.data.ClStock_A),vClStockSourceId=t.record.data.ClStockSourceId,vAmcChangeReasonId=t.record.data.AmcChangeReasonId,vBeforeLastMonthDispensed=isNorE(t.record.data.BeforeLastMonthDispensed),vBeforeLastMonthDispensedDevisor=vBeforeLastMonthDispensed>0?1:0,vLastMonthDispensed=isNaN(t.record.data.LastMonthDispensed)||""==t.record.data.LastMonthDispensed?0:t.record.data.LastMonthDispensed,vLastMonthDispensedDevisor=vLastMonthDispensed>0?1:0,vDispenseQtyDevisor=vDispenseQty>0?1:0,v3MonthTotal=isNorE(vBeforeLastMonthDispensed)+isNorE(vLastMonthDispensed)+isNorE(vDispenseQty),vDevisor=isNorE(vBeforeLastMonthDispensedDevisor)+isNorE(vLastMonthDispensedDevisor)+isNorE(vDispenseQtyDevisor),vAMC_C=Math.round(v3MonthTotal/vDevisor),vAMC_C=isNaN(vAMC_C)||""==vAMC_C?0:vAMC_C,t.record.set("AMC_C",vAMC_C),t.field){case"ClStock_A":vClStock_A=isNorE(t.record.data.ClStock_A),vAMC=isNorE(t.record.data.AMC),0==pFacilityCount?(vMOS=(0!=vAMC?vClStock_A/vAMC:0).toFixed(2),vMOS=isNaN(vMOS)||""==vMOS?0:vMOS,t.record.set("AMC",vAMC),t.record.set("MOS",vMOS),t.record.set("MaxQty",3*vAMC)):(vMOS=(0!=vAMC?vClStock_A/vAMC:0).toFixed(2),vMOS=isNaN(vMOS)||""==vMOS?0:vMOS,t.record.set("MOS",vMOS),t.record.set("MaxQty",3*vAMC)),vMaxQty=3*vAMC,vOrderQty=0>vMaxQty-vClStock_A?0:vMaxQty-vClStock_A,t.record.set("OrderQty",vOrderQty),vOrderQty=isNorE(t.record.data.OrderQty),t.record.set("ActualQty",vOrderQty),vActualQty=isNorE(t.record.data.ActualQty),oOpStock_A=isNorE(t.record.data.OpStock_A),oReceiveQty=isNorE(t.record.data.ReceiveQty),oAdjustQty=isNorE(t.record.data.AdjustQty),oClStock_A=isNorE(t.record.data.ClStock_A),oDispenseQty=isNorE(t.record.data.DispenseQty),oOpStock_A+oReceiveQty+oAdjustQty-oClStock_A!=oDispenseQty&&alert(TEXT.Msg_Validation+(oOpStock_A+oReceiveQty+oAdjustQty-oDispenseQty));break;case"DispenseQty":0==pFacilityCount&&(vAMC=Math.round(v3MonthTotal/vDevisor),vAMC=isNorE(vAMC),t.record.set("AMC",vAMC),vMOS=(0!=vAMC?vClStock_A/vAMC:0).toFixed(2),vMOS=isNorE(vMOS),t.record.set("MOS",vMOS),t.record.set("MaxQty",3*vAMC));break;case"ActualQty":vMaxQty=isNorE(t.record.data.MaxQty),vOrderQty=isNorE(t.record.data.OrderQty),vActualQty=isNorE(t.record.data.ActualQty);break;case"AMC":vAMC=isNorE(t.record.data.AMC),vMOS=(0!=vAMC?vClStock_A/vAMC:0).toFixed(2),vMOS=isNorE(vMOS),t.record.set("MOS",vMOS),t.record.set("MaxQty",3*vAMC);break;case"OUReasonId":vActualQty=isNorE(t.record.data.ActualQty)}"ClStockSourceId"!=t.field&&t.record.set("ClStockSourceId",1)}function setYearId(){var t=currentDate.getFullYear(),e=Ext.getCmp("cboYearId").getStore(),a=e.find("YearId",t);-1!=a&&(Ext.getCmp("cboYearId").setValue(t),pYearId=Ext.getCmp("cboYearId").getValue(),""!=pYearId&&(dsFacility.setBaseParam("pYearId",pYearId),setBaseParams("pYearId",pYearId)))}function setMonthId(){var t=currentDate.getMonth()+1,e=Ext.getCmp("cboMonthId").getStore(),a=e.find("MonthId",t);-1!=a&&(Ext.getCmp("cboMonthId").setValue(t),pMonthId=Ext.getCmp("cboMonthId").getValue(),""!=pMonthId&&(dsFacility.setBaseParam("pMonthId",pMonthId),setBaseParams("pMonthId",pMonthId)))}function handler_to_makeReadOnly(){return bReadOnly}function createReport(){if(vMonthId=Ext.getCmp("cboMonthId").getValue(),vYearId=Ext.getCmp("cboYearId").getValue(),vCountryId=Ext.getCmp("cboCountryId").getRawValue(),vItemGroupId=Ext.getCmp("cboItemGroupId").getRawValue(),vMonth=Ext.getCmp("cboMonthId").getRawValue(),vYear=Ext.getCmp("cboYearId").getRawValue(),""!=vCountryId&&""!=vMonthId&&""!=vYearId)if(selYearId=parseInt(vYearId),selMonth=parseInt(vMonthId),selInitYearId=parseInt(initYearId),selInitMonthId=parseInt(initMonthId),selInitYearId>selYearId){Ext.Msg.show({msg:"Starting Month-Year for ARV Data is "+startManthName+"-"+initYearId,icon:Ext.Msg.INFO,minWidth:200,buttons:Ext.Msg.OK,scope:this}).getDialog()}else if(selYearId==selInitYearId&&selInitMonthId>selMonth){Ext.Msg.show({msg:"Starting Month-Year for ARV Data is "+startManthName+"-"+initYearId,icon:Ext.Msg.INFO,minWidth:200,buttons:Ext.Msg.OK,scope:this}).getDialog()}else getFacilityRecordOfPrevMonth();else{Ext.Msg.show({msg:"You must select country, itemgroup, month, year and facility.",icon:Ext.Msg.INFO,minWidth:200,buttons:Ext.Msg.OK,scope:this}).getDialog()}}function clearMasterInfo(){document.getElementById("txtReportIdDiv").innerHTML="",document.getElementById("txtSubmitStatusDiv").innerHTML="",document.getElementById("created-by").innerHTML="",document.getElementById("created-date").innerHTML="",document.getElementById("submitted-by").innerHTML="",document.getElementById("submitted-date").innerHTML="",document.getElementById("updated-by").innerHTML="",document.getElementById("updated-date").innerHTML="",document.getElementById("published-by").innerHTML="",document.getElementById("published-date").innerHTML=""}function setBaseParams(t,e){dsPatientOverview.setBaseParam(t,e),dsAdultRegimens.setBaseParam(t,e),dsArvData.setBaseParam(t,e),dsMasterStockData.setBaseParam(t,e)}function loadFacility(){null!=pCountryId&&null!=pRegionId&&null!=pDistrictId&&null!=pOwnerTypeId&&null!=pMonthId&&null!=pYearId&&(pDistrictId==tmpDistrictId?(gridFacility.store.lastOptions&&(start=gridFacility.store.lastOptions.params.start),tmpDistrictId=pDistrictId):(start=0,tmpDistrictId=pDistrictId),dsFacility.removeAll(!0),dsFacility.load({params:{start:start,limit:25}}))}function saveGridRow(selModel,rowIndex,record){gridArvData.stopEditing();var ed=gridArvData.activeEditor,msgboxpos,msgboxpos2,vMsg="",gposition=gridArvData.getPosition();if(record.dirty){if(opStock_A=isNorE(record.data.OpStock_A),receiveQty=isNorE(record.data.ReceiveQty),adjustQty=isNorE(record.data.AdjustQty),clStock_A=isNorE(record.data.ClStock_A),dispenseQty=isNorE(record.data.DispenseQty),adjustReason=""==record.data.AdjustReason?0:record.data.AdjustReason,stockOutDays=isNorE(record.data.StockoutDays),stockOutReason=""==record.data.StockOutReasonId?0:record.data.StockOutReasonId,amc=isNorE(record.data.AMC),maxQty=isNorE(record.data.MaxQty),orderQty=isNorE(record.data.OrderQty),actualQty=isNorE(record.data.ActualQty),oUReasonId=""==record.data.OUReasonId?0:record.data.OUReasonId,0==adjustQty&&"0"!=adjustReason)return msgboxpos=Ext.Msg.show({title:"Data validation",msg:"Please fill adjust quantity first, then set the reason.",icon:Ext.Msg.QUESTION,buttons:Ext.Msg.OK,fn:function(){gridArvData.getSelectionModel().selectRow(rIndex),gridArvData.startEditing(rIndex,cIndex)},scope:this}).getDialog(),void ed.completeEdit();if(adjustQty>0&&"0"==adjustReason)return msgboxpos=Ext.Msg.show({title:"Data validation",msg:"You must select adjust reason.",icon:Ext.Msg.QUESTION,buttons:Ext.Msg.OK,fn:function(){gridArvData.getSelectionModel().selectRow(rIndex),gridArvData.startEditing(rIndex,cIndex)},scope:this}).getDialog(),void ed.completeEdit();if(0==parseInt(stockOutDays)&&"0"!=stockOutReason)return msgboxpos2=Ext.Msg.show({title:"Data validation",msg:"You must fill stockout days.",icon:Ext.Msg.QUESTION,buttons:Ext.Msg.OK,fn:function(){gridArvData.getSelectionModel().selectRow(rIndex),gridArvData.startEditing(rIndex,cIndex)},scope:this}).getDialog(),void ed.completeEdit();if(parseInt(stockOutDays)>0&&!isValidDays(record.data.Year,record.data.MonthId,parseInt(stockOutDays)))return msgboxpos=Ext.Msg.show({title:"Data validation",msg:"You must select a vaild number of days.",icon:Ext.Msg.QUESTION,buttons:Ext.Msg.OK,fn:function(){gridArvData.getSelectionModel().selectRow(rIndex),gridArvData.startEditing(rIndex,cIndex)},scope:this}).getDialog(),void ed.completeEdit();if(parseInt(stockOutDays)>0&&"0"==stockOutReason)return msgboxpos2=Ext.Msg.show({title:"Data validation",msg:"You must select a stockout reason.",icon:Ext.Msg.QUESTION,buttons:Ext.Msg.OK,fn:function(){gridArvData.getSelectionModel().selectRow(rIndex),gridArvData.startEditing(rIndex,cIndex)},scope:this}).getDialog(),void ed.completeEdit();if(""===record.data.ClStock_A)return msgboxpos=Ext.Msg.show({title:TEXT["Data validation"],msg:"You must enter closing balance at least 0 or more",icon:Ext.Msg.QUESTION,buttons:Ext.Msg.OK,fn:function(){gridArvData.getSelectionModel().selectRow(rIndex),gridArvData.startEditing(rIndex,cIndex)}}).getDialog(),void ed.completeEdit();if(actualQty!=orderQty&&"0"==oUReasonId)return msgboxpos=Ext.Msg.show({title:"Data validation",msg:"Quantity to Order should be equal to "+orderQty+"<br/>( Max Quantity - Stock on Hand ).<br/>You must select order quantity update reason.",icon:Ext.Msg.QUESTION,buttons:Ext.Msg.OK,fn:function(){gridArvData.getSelectionModel().selectRow(rIndex),gridArvData.startEditing(rIndex,cIndex)},scope:this}).getDialog(),void ed.completeEdit();if(actualQty==orderQty&&oUReasonId>0)return msgboxpos=Ext.Msg.show({title:"Data validation",msg:"Order Qty and Actual Qty are the same, Please select None in Order Qty update reason.",icon:Ext.Msg.QUESTION,buttons:Ext.Msg.OK,fn:function(){gridArvData.getSelectionModel().selectRow(rIndex),gridArvData.startEditing(rIndex,cIndex)},scope:this}).getDialog(),void ed.completeEdit();Ext.Ajax.request({waitMsg:"Please wait...",url:baseUrl+"t_facility_level_monthlystatus_ext_server.php",params:{action:"updateStockData",pARVDataId:vARVDataId,pOpStock_C:record.data.OpStock_A,pOpStock_A:record.data.OpStock_A,pReceiveQty:record.data.ReceiveQty,pDispenseQty:record.data.DispenseQty,pAdjustQty:record.data.AdjustQty,pAdjustReason:vAdjustReason,pStockoutDays:record.data.StockoutDays,pStockOutReasonId:vStockOutReasonId,pOrderQty:record.data.OrderQty,pMOS:record.data.MOS,pAMC_C:record.data.AMC_C,pAMC:record.data.AMC,pAmcChangeReasonId:vAmcChangeReasonId,pClStock_C:record.data.ClStock_C,pClStock_A:record.data.ClStock_A,pClStockSourceId:vClStockSourceId,pMaxQty:record.data.MaxQty,pOrderQty:record.data.OrderQty,pActualQty:record.data.ActualQty,pOUReasonId:vOUReasonId,pFacilityId:pFacilityId,pMonthId:pMonthId,pYearId:pYearId,pReportId:pReportId,pUserId:pUserId,lang:lan},success:function(response){switch(eval(response.responseText),success){case 1:break;case 0:Ext.Msg.show({msg:error,icon:Ext.Msg.INFO,minWidth:300,buttons:Ext.Msg.OK,scope:this});break;default:Ext.Msg.show({msg:response.responseText,icon:Ext.Msg.INFO,minWidth:300,buttons:Ext.Msg.OK,scope:this})}}}),record.commit(),gridArvData.getView().refresh(),rIndex=-99}}function showData(){if(vMonthId=Ext.getCmp("cboMonthId").getValue(),vYearId=Ext.getCmp("cboYearId").getValue(),vMonth=Ext.getCmp("cboMonthId").getRawValue(),vYear=Ext.getCmp("cboYearId").getRawValue(),""!=vMonthId&&""!=vYearId)if(selYearId=parseInt(vYearId),selMonth=parseInt(vMonthId),selInitYearId=parseInt(initYearId),selInitMonthId=parseInt(initMonthId),selInitYearId>selYearId){Ext.Msg.show({msg:"Starting Month-Year for ARV Data is "+startManthName+"-"+initYearId,icon:Ext.Msg.INFO,minWidth:200,buttons:Ext.Msg.OK,scope:this}).getDialog()}else if(selYearId==selInitYearId&&selInitMonthId>selMonth){Ext.Msg.show({msg:"Starting Month-Year for ARV Data is "+startManthName+"-"+initYearId,icon:Ext.Msg.INFO,minWidth:200,buttons:Ext.Msg.OK,scope:this}).getDialog()}else selYearId==selInitYearId&&selMonth==selInitMonthId?loadMasterStockData():getFacilityRecordOfPrevMonth();else{Ext.Msg.show({msg:"You must select facility, month and year.",icon:Ext.Msg.INFO,minWidth:200,buttons:Ext.Msg.OK,scope:this}).getDialog()}}function printHtml(){return!pReportId>0?void alert("Please select a valid report to print"):void window.open(baseUrl+"report/t_facility_data_entry_print.php?jBaseUrl="+jBaseUrl+"&CFMStockId="+pReportId+"&CountryId="+pCountryId+"&ItemGroupId="+pItemGroupId+"&YearId="+pYearId+"&MonthId="+pMonthId+"&FacilityId="+pFacilityId+"&lan="+lan)}function printExcel(){return!pReportId>0?void alert("Please select a valid report to print"):void window.open(baseUrl+"report/t_facility_data_entry_excel.php?jBaseUrl="+jBaseUrl+"&CFMStockId="+pReportId+"&CountryId="+pCountryId+"&ItemGroupId="+pItemGroupId+"&YearId="+pYearId+"&MonthId="+pMonthId+"&FacilityId="+pFacilityId+"&lan="+lan)}function printPdf(){if(!pReportId>0)return void alert("Please select a valid report to print");$("#month-list option:selected").text(),$("#item-group option:selected").text(),$("#region-list option:selected").text();$.ajax({url:baseUrl+"report/t_facility_data_entry_pdf.php",type:"post",data:{action:"FacilityDataEntryReportPDF",CFMStockId:pReportId,CountryId:pCountryId,ItemGroupId:pItemGroupId,YearId:pYearId,MonthId:pMonthId,FacilityId:pFacilityId,lan:lan},success:function(t){"Processing Error"==t?alert("No Record Found."):window.open(baseUrl+"report/pdfslice/"+t)}})}function showHideFacility(){var t=Ext.get("grid-facility"),e=Ext.get("tabArvdata");t.setVisibilityMode(Ext.Element.DISPLAY),e.setVisibilityMode(Ext.Element.DISPLAY),this.pressed?(t.hide(),e.setStyle("width","100%")):(t.show(),e.setStyle("width","80%")),tabArvdata.doLayout();var a=Ext.getCmp("tabItemArvData");a.doLayout();var o=Ext.getCmp("tabItemPatientOverviewId");o.doLayout();var d=Ext.getCmp("tabItemAdultRegimens");d.doLayout(),"tabItemArvData"==selectedTab?gridArvData.getView().refresh():"tabItemPatientOverviewId"==selectedTab?gridPatientOverview.getView().refresh():"tabItemAdultRegimens"==selectedTab&&gridAdultRegimens.getView().refresh()}function makeUnpublished(){if(0>=pReportId)return void alert("Please select a report first.");1==pStatusId?pStatusId=2:2==pStatusId?pStatusId=3:3==pStatusId&&(pStatusId=5);Ext.Msg.show({msg:TEXT.Msg_Unpublish,icon:Ext.Msg.QUESTION,minWidth:200,buttons:Ext.Msg.YESNO,scope:this,fn:function(t){"yes"==t&&Ext.Ajax.request({waitMsg:"Please wait...",url:baseUrl+"t_facility_level_monthlystatus_ext_server.php",params:{action:"makeUnpublished",pFacilityId:pFacilityId,pOwnerTypeId:pOwnerTypeId,pMonthId:pMonthId,pYearId:pYearId,pReportId:pReportId,pUserId:pUserId,pCountryId:pCountryId,pItemGroupId:pItemGroupId,pStatusId:pStatusId,lang:lan},success:function(){loadMasterStockData(),loadAllData(),loadFacility();Ext.Msg.show({msg:TEXT["Your report unpublished successfully"],icon:Ext.Msg.INFO,minWidth:200,buttons:Ext.Msg.OK,scope:this}).getDialog()}})}}).getDialog()}function getFacilityRecordOfPrevMonth(){Ext.Ajax.request({waitMsg:"Please wait...",url:baseUrl+"t_facility_level_monthlystatus_ext_server.php",params:{action:"getFacilityRecordOfPrevMonth",pFacilityId:pFacilityId,pMonthId:pMonthId,pYearId:pYearId,pCountryId:pCountryId,pItemGroupId:pItemGroupId,lang:lan},success:function(response){if(eval(response.responseText),selYearId==selInitYearId&&selMonth==selInitMonthId){vMonth=Ext.getCmp("cboMonthId").getRawValue(),vYear=Ext.getCmp("cboYearId").getRawValue();var msgbox=Ext.Msg.show({msg:"You ("+vFacility+") don't have the report on "+vMonth+"-"+vYear+", Do you want to create report?",icon:Ext.Msg.QUESTION,minWidth:200,buttons:Ext.Msg.YESNO,scope:this,fn:function(t){"yes"==t&&insertIntoStockData()}}).getDialog()}else{if(prev_month_report<=0){var msgbox=Ext.Msg.show({msg:TEXT.Msg_NoReport,icon:Ext.Msg.QUESTION,minWidth:200,buttons:Ext.Msg.OK,scope:this}).getDialog();return}if(prev_month_report_unpub>0){var msgbox=Ext.Msg.show({msg:TEXT.Msg_UnPublished,icon:Ext.Msg.QUESTION,minWidth:200,buttons:Ext.Msg.OK,scope:this}).getDialog();return}vMonth=Ext.getCmp("cboMonthId").getRawValue(),vYear=Ext.getCmp("cboYearId").getRawValue();var msgbox=Ext.Msg.show({msg:"You ("+vFacility+") don't have the report on "+vMonth+"-"+vYear+", Do you want to create report?",icon:Ext.Msg.QUESTION,minWidth:200,buttons:Ext.Msg.YESNO,scope:this,fn:function(t){"yes"==t&&insertIntoStockData()}}).getDialog()}}})}function saveAllRecords(){gridArvData.getPosition();gridArvData.stopEditing();var t=[];invalidMsgCount=0,Ext.each(gridArvData.getStore().getModifiedRecords(),function(e){if(e.data.OpStock_A+e.data.ReceiveQty+e.data.AdjustQty-e.data.ClStock_A!=e.data.DispenseQty?invalidMsgCount++:t.push(e.data),invalidMsgCount>0){Ext.Msg.show({title:"Data validation",msg:"Opening + Received + AdjustedQty - Closing != Dispensed",icon:Ext.Msg.QUESTION,buttons:Ext.Msg.OK}).getDialog()}}),0==invalidMsgCount&&Ext.Ajax.request({url:baseUrl+"t_facility_level_monthlystatus_ext_server.php",params:{action:"updateStockDataAll",pFacilityId:pFacilityId,pMonthId:pMonthId,pYearId:pYearId,pReportId:pReportId,pUserId:pUserId,data:Ext.encode(t),lang:lan},success:function(){gridArvData.getStore().commitChanges(),gridArvData.getView().refresh(),t=[];Ext.Msg.show({title:TEXT["Success Message"],msg:TEXT["Records updated successfully"],icon:Ext.Msg.QUESTION,buttons:Ext.Msg.OK}).getDialog()},failure:function(){}})}function insertIntoStockData(){Ext.Ajax.request({waitMsg:"Please wait...",url:baseUrl+"t_facility_level_monthlystatus_ext_server.php",params:{action:"insertIntoStockData",pFacilityId:pFacilityId,pFLevelId:pFLevelId,pMonthId:pMonthId,pYearId:pYearId,pFormulationId:1,pUserId:pUserId,pCountryId:pCountryId,pItemGroupId:pItemGroupId,lang:lan},success:function(){loadMasterStockData(),loadAllData(),loadFacility()}})}function loadMasterStockData(){dsMasterStockData.load({params:{pFacilityId:pFacilityId,pMonthId:pMonthId,pYearId:pYearId,pCountryId:pCountryId,pItemGroupId:pItemGroupId,lang:lan}})}function loadAllData(){dsPatientOverview.load({params:{pFacilityId:pFacilityId,pMonthId:pMonthId,pYearId:pYearId,pCountryId:pCountryId,pItemGroupId:pItemGroupId,lang:lan,start:0,limit:15}}),dsAdultRegimens.load({params:{pFacilityId:pFacilityId,pMonthId:pMonthId,pYearId:pYearId,pCountryId:pCountryId,pItemGroupId:pItemGroupId,pFormulationId:1,lang:lan,start:0,limit:15}}),dsArvData.load({params:{pFacilityId:pFacilityId,pMonthId:pMonthId,pYearId:pYearId,pCountryId:pCountryId,pItemGroupId:pItemGroupId,start:0,limit:20}})}function resetStoreAndGrid(){}function changeBsubmittedInMaster(){var t="";1==pStatusId?(pStatusId=2,t=TEXT.Msg_Submit):2==pStatusId&&(pStatusId=5,t=TEXT.Msg_Publish);Ext.Msg.show({msg:t,icon:Ext.Msg.QUESTION,minWidth:200,buttons:Ext.Msg.YESNO,scope:this,fn:function(t){"yes"==t&&Ext.Ajax.request({waitMsg:"Please wait...",url:baseUrl+"t_facility_level_monthlystatus_ext_server.php",params:{action:"changeBsubmittedInMaster",pFacilityId:pFacilityId,pMonthId:pMonthId,pYearId:pYearId,pReportId:pReportId,pUserId:pUserId,pCountryId:pCountryId,pItemGroupId:pItemGroupId,pOwnerTypeId:pOwnerTypeId,pStatusId:pStatusId,lang:lan},success:function(){loadMasterStockData(),loadAllData(),loadFacility();Ext.Msg.show({msg:"Your report submitted successfully.",icon:Ext.Msg.INFO,minWidth:200,buttons:Ext.Msg.OK,scope:this}).getDialog()}})}}).getDialog()}function deleteRecord(){if(vMonthId=Ext.getCmp("cboMonthId").getValue(),vYearId=Ext.getCmp("cboYearId").getValue(),vMonth=Ext.getCmp("cboMonthId").getRawValue(),vYear=Ext.getCmp("cboYearId").getRawValue(),""!=vMonthId&&""!=vYearId)var msgbox=Ext.Msg.show({msg:"Do you want to delete all the records of "+vFacility+" on "+vMonth+"-"+vYear+"?",icon:Ext.Msg.QUESTION,minWidth:200,buttons:Ext.Msg.YESNO,scope:this,fn:function(response){"yes"==response&&Ext.Ajax.request({waitMsg:"Please wait...",url:baseUrl+"t_facility_level_monthlystatus_ext_server.php",params:{action:"delete_data_from_yyyy",pFacilityId:pFacilityId,pOwnerTypeId:pOwnerTypeId,pMonthId:pMonthId,pYearId:pYearId,pCountryId:pCountryId,pItemGroupId:pItemGroupId,lang:lan},success:function(response){eval(response.responseText),1==success&&(clearMasterInfo(),elePanelMaster.hide(),Ext.getCmp("submitid").enable(),pReportId=0,loadAllData(),loadFacility())}})}}).getDialog();else var msgbox=Ext.Msg.show({msg:"You must select Facility, Month and Year.",icon:Ext.Msg.INFO,minWidth:200,buttons:Ext.Msg.OK,scope:this}).getDialog()}function loadMaster(){resetStoreAndGrid();var t=gridArvData.getColumnModel();pFacilityCount>0?(t.setColumnHeader(CLM_DISPENSEQTY,TEXT.Issued+"<br/>(C)"),t.setColumnTooltip(CLM_DISPENSEQTY,TEXT.Issued+" Quantity -> (C)"),t.setHidden(CLM_AMC,!0),t.setHidden(CLM_MOS,!0),t.setHidden(CLM_MAXQTY,!0),t.setHidden(CLM_ORDERQTY,!0),t.setHidden(CLM_ACTUALQTY,!0),t.setHidden(CLM_OUREASONID,!0)):(t.setColumnHeader(CLM_DISPENSEQTY,TEXT.Dispensed+"<br/>(C)"),t.setColumnTooltip(CLM_DISPENSEQTY,TEXT.Dispensed+" Quantity -> (C)"),t.setHidden(CLM_AMC,!1),t.setHidden(CLM_MOS,!1),t.setHidden(CLM_MAXQTY,!1),t.setHidden(CLM_ORDERQTY,!1),t.setHidden(CLM_ACTUALQTY,!1),t.setHidden(CLM_OUREASONID,!1)),loadMasterStockData()}function getOpeningEditable(){vMonthId=Ext.getCmp("cboMonthId").getValue(),vYearId=Ext.getCmp("cboYearId").getValue();var t=Ext.getCmp("gridArvDataId").getColumnModel(),e=t.getColumnAt(8);e.editable=vMonthId==initMonthId&&vYearId==initYearId?!0:!1}function isValidDays(t,e,a){var o=new Date(t,1*e,-.1).getDate();return a>=1&&o>=a?!0:!1}Ext.QuickTips.init(),searchfield=new Ext.ux.grid.Search({searchText:TEXT.Search,mode:"remote",position:top,width:220,minChars:1,autoFocus:!0,showSelectAll:!0}),pUserId=jUserId,Date.prototype.getMonthName=function(){var t=["January","February","March","April","May","June","July","August","September","October","November","December"];return t[this.getMonth()]},initMonthId=-1,initYearId=-1;var startDate,startManthName,selYearId=0,selMonth=0,selInitYearId=0,selInitMonthId=0,currentDate=new Date;currentDate.prevMonth(),initialize();var acEditor;Ext.override(Ext.grid.RowSelectionModel,{moveEditorOnEnterLikeOnTab:!1,onEditorKey:function(t,e){var a,o,d,i,r,n=e.getKey(),s=this.grid,d=s.lastEdit,l=s.activeEditor,c=e.shiftKey,p=s.getStore().getCount(),u=s.getSelectionModel().getSelected(),g=s.getStore().indexOf(u);n==e.TAB?(e.stopEvent(),l.completeEdit(),a=c?s.walkCells(l.row,l.col-1,-1,this.acceptsNav,this):s.walkCells(l.row,l.col+1,1,this.acceptsNav,this)):n==e.ENTER?this.moveEditorOnEnterLikeOnTab?a=c?s.walkCells(d.row,d.col-1,-1,this.acceptsNav,this):g==p-1&&g==d.row&&20==d.col?s.walkCells(0,0,1,this.acceptsNav,this):s.walkCells(d.row,d.col+1,1,this.acceptsNav,this):this.moveEditorOnEnter!==!1&&(a=c?s.walkCells(d.row-1,d.col,-1,this.acceptsNav,this):s.walkCells(d.row+1,d.col,1,this.acceptsNav,this)):n==e.RIGHT?(e.stopEvent(),l.completeEdit(),a=s.walkCells(l.row,l.col+1,1,this.acceptsNav,this)):n==e.LEFT?(e.stopEvent(),l.completeEdit(),a=s.walkCells(l.row,l.col-1,-1,this.acceptsNav,this)):n==e.DOWN?(e.stopEvent(),l.completeEdit(),a=s.walkCells(d.row+1,d.col,1,this.acceptsNav,this)):n==e.UP&&(e.stopEvent(),l.completeEdit(),a=s.walkCells(d.row-1,d.col,-1,this.acceptsNav,this)),a&&(i=a[0],r=a[1],this.onEditorSelect(i,d.row),s.isEditor&&s.editing&&(o=s.activeEditor,o&&o.field.triggerBlur&&o.field.triggerBlur()),s.startEditing(i,r))}});var fm=Ext.form,dsRegion=new Ext.data.Store({reader:new Ext.data.JsonReader({fields:["RegionId","RegionName"],root:"rows"}),proxy:new Ext.data.HttpProxy({url:baseUrl+"combo_ext.php"}),baseParams:{action:"getRegionByCId",pCountryId:1,lang:vLang}}),dsDistricts=new Ext.data.Store({id:"dsDistrictsId",reader:new Ext.data.JsonReader({fields:[{name:"DistrictId",type:"int",mapping:"DistrictId"},{name:"DistrictName",type:"string",mapping:"DistrictName"}],root:"rows"}),proxy:new Ext.data.HttpProxy({url:baseUrl+"combo_ext.php"}),baseParams:{action:"getDistrictsByCR",lang:lan},sortInfo:{field:"DistrictName",direction:"ASC"}});dsFacility=new Ext.data.GroupingStore({id:"FacilityWithMonthStatusId",proxy:new Ext.data.HttpProxy({url:baseUrl+"t_facility_level_monthlystatus_ext_server.php",method:"POST"}),baseParams:{action:"getFacilityWithMonthStatus",jUserId:jUserId,lang:lan},reader:new Ext.data.JsonReader({root:"results",totalProperty:"total",id:"id"},[{name:"FacilityId",type:"int",mapping:"FacilityId"},{name:"FacilityName",type:"string",mapping:"FacilityName"},{name:"FLevelId",type:"int",mapping:"FLevelId"},{name:"DistrictName",type:"string",mapping:"DistrictName"},{name:"StartMonthId",type:"int",mapping:"StartMonthId"},{name:"StartYearId",type:"string",mapping:"StartYearId"},{name:"SupplyFrom",type:"int",mapping:"SupplyFrom"},{name:"FacilityCount",type:"int",mapping:"FacilityCount"},{name:"CFMStockId",type:"int",mapping:"CFMStockId"},{name:"StatusId",type:"int",mapping:"StatusId"}]),groupField:"DistrictName"}),dsFacility.on("load",function(){gridFacility.getSelectionModel().selectRow(gRowIndex,!0)}),dsYear=new Ext.data.Store({id:"dsYearId",reader:new Ext.data.JsonReader({fields:[{name:"YearId",type:"int",mapping:"YearId"},{name:"YearName",type:"string",mapping:"YearName"}],root:"rows"}),proxy:new Ext.data.HttpProxy({url:baseUrl+"combo_ext.php"}),baseParams:{action:"getYear",lang:lan},autoLoad:!0,sortInfo:{field:"YearId",direction:"ASC"}}),dsYear.on("load",setYearId,this,{single:!0}),dsMonth=new Ext.data.Store({id:"dsMonthId",reader:new Ext.data.JsonReader({fields:[{name:"MonthId",type:"int",mapping:"MonthId"},{name:"MonthName",type:"string",mapping:"MonthName"}],root:"rows"}),proxy:new Ext.data.HttpProxy({url:baseUrl+"combo_ext.php"}),baseParams:{action:"getMonth",lang:lan},autoLoad:!0,sortInfo:{field:"MonthId",direction:"ASC"}}),dsMonth.on("load",setMonthId,this,{single:!0}),dsAdjustReason=new Ext.data.Store({reader:new Ext.data.JsonReader({fields:["AdjustId","AdjustReason"],root:"rows"}),proxy:new Ext.data.HttpProxy({url:baseUrl+"combo_ext.php"}),baseParams:{action:"getAdjust",lang:lan},autoLoad:!0}),dsClStockSource=new Ext.data.Store({reader:new Ext.data.JsonReader({fields:["ClStockSourceId","SourceName"],root:"rows"}),proxy:new Ext.data.HttpProxy({url:baseUrl+"combo_ext.php"}),baseParams:{action:"getClStockSource",lang:lan},autoLoad:!0}),dsAmcChangeReason=new Ext.data.Store({reader:new Ext.data.JsonReader({fields:["AmcChangeReasonId","AmcChangeReasonName"],root:"rows"}),proxy:new Ext.data.HttpProxy({url:baseUrl+"combo_ext.php"}),baseParams:{action:"getAmcChangeReason",lang:lan},autoLoad:!0}),dsOrderQtyChangeReason=new Ext.data.Store({reader:new Ext.data.JsonReader({fields:["OUReasonId","OUReason"],root:"rows"}),proxy:new Ext.data.HttpProxy({url:baseUrl+"combo_ext.php"}),baseParams:{action:"getOrderQtyChangeReason",lang:lan},autoLoad:!0}),dsStockOutReason=new Ext.data.Store({reader:new Ext.data.JsonReader({fields:["StockOutReasonId","StockOutReasonName"],root:"rows"}),proxy:new Ext.data.HttpProxy({url:baseUrl+"combo_ext.php"}),baseParams:{action:"getStockOutReason",lang:lan},autoLoad:!0}),dsPatientOverview=new Ext.data.Store({id:"dsPatientOverviewId",proxy:new Ext.data.HttpProxy({url:baseUrl+"t_facility_level_monthlystatus_ext_server.php",method:"POST"}),baseParams:{action:"getPatientOverview",jUserId:jUserId,lang:lan},reader:new Ext.data.JsonReader({root:"results",totalProperty:"total",id:"id"},[{name:"CFMPOId",type:"int",mapping:"CFMPOId"},{name:"PatientTypeName",type:"string",mapping:"PatientTypeName"},{name:"RefillPatient",type:"int",mapping:"RefillPatient"},{name:"NewPatient",type:"int",mapping:"NewPatient"},{name:"TotalPatient",type:"int",mapping:"TotalPatient"}]),sortInfo:{field:"CFMPOId",direction:"ASC"}}),dsPatientOverview.on("exception",function(){},this);var gridPatientOverview=new Ext.grid.EditorGridPanel({id:"patient-overview-id",region:"center",style:"text-align:left",stripeRows:!0,store:dsPatientOverview,clicksToEdit:1,region:"fit",width:"100%",loadMask:{msg:TEXT["Loading data."],enabled:!0},sm:new Ext.grid.RowSelectionModel({singleSelect:!0}),columns:[new Ext.grid.RowNumberer({header:"#"}),{header:"CFMPOId",width:120,dataIndex:"CFMPOId",sortable:!0,hidden:!0},{header:TEXT["Patient Type"],width:200,align:"left",dataIndex:"PatientTypeName",sortable:!0,hidden:!1},{header:TEXT["Refill Patients"],width:150,align:"right",dataIndex:"RefillPatient",sortable:!0,hidden:!0,renderer:render_val,editor:new fm.NumberField({allowBlank:!0,allowNegative:!1,maxValue:1e7,selectOnFocus:!0})},{header:TEXT["New Patients"],width:150,align:"right",dataIndex:"NewPatient",sortable:!0,hidden:!0,renderer:render_val,editor:new fm.NumberField({allowBlank:!0,allowNegative:!1,maxValue:1e7,selectOnFocus:!0})},{header:TEXT["Total Patients"],width:150,align:"right",dataIndex:"TotalPatient",sortable:!0,hidden:!1,renderer:render_val,editor:new fm.NumberField({allowBlank:!0,allowNegative:!1,maxValue:1e7,selectOnFocus:!0})}],viewConfig:{},autoHeight:!0,align:"center",columnLines:!0});
gridPatientOverview.on("afteredit",savePatientOverview),gridPatientOverview.on("beforeedit",handler_to_makeReadOnly),dsAdultRegimens=new Ext.data.Store({id:"dsPatientOverviewId",proxy:new Ext.data.HttpProxy({url:baseUrl+"t_facility_level_monthlystatus_ext_server.php",method:"POST"}),baseParams:{action:"getRegimens",pFormulationId:1,jUserId:jUserId,lang:lan},reader:new Ext.data.JsonReader({root:"results",totalProperty:"total",id:"id"},[{name:"FormulationId",type:"int",mapping:"FormulationId"},{name:"FormulationName",type:"string",mapping:"FormulationName"},{name:"C0to4M",type:"int",mapping:"C0to4M"},{name:"C0to4M_Id",type:"int",mapping:"C0to4M_Id"},{name:"C0to4F",type:"int",mapping:"C0to4F"},{name:"C0to4F_Id",type:"int",mapping:"C0to4F_Id"},{name:"C5to14M",type:"int",mapping:"C5to14M"},{name:"C5to14M_Id",type:"int",mapping:"C5to14M_Id"},{name:"C5to14F",type:"int",mapping:"C5to14F"},{name:"C5to14F_Id",type:"int",mapping:"C5to14F_Id"},{name:"C15PlusM",type:"int",mapping:"C15PlusM"},{name:"C15PlusM_Id",type:"int",mapping:"C15PlusM_Id"},{name:"C15PlusF",type:"int",mapping:"C15PlusF"},{name:"C15PlusF_Id",type:"int",mapping:"C15PlusF_Id"},{name:"PregnantWomen",type:"int",mapping:"PregnantWomen"},{name:"PregnantWomen_Id",type:"int",mapping:"PregnantWomen_Id"}]),sortInfo:{field:"FormulationName",direction:"ASC"}}),dsAdultRegimens.on("exception",function(){},this);var categoryGroupRow=[];categoryGroupRow.push({header:"",align:"center",colspan:3}),categoryGroupRow.push({header:TEXT["0-4 Years"],align:"center",colspan:2}),categoryGroupRow.push({header:TEXT["5-14 Years"],align:"center",colspan:2}),categoryGroupRow.push({header:TEXT["15+ Years"],align:"center",colspan:2}),categoryGroupRow.push({header:"",align:"center",colspan:1});var catGroup=new Ext.ux.grid.ColumnHeaderGroup({rows:[categoryGroupRow]});gridAdultRegimens=new Ext.grid.EditorGridPanel({id:"adult-regimens-id",region:"center",style:"text-align:left",stripeRows:!0,store:dsAdultRegimens,clicksToEdit:1,region:"fit",width:"100%",loadMask:{msg:TEXT["Loading data."],enabled:!0},sm:new Ext.grid.RowSelectionModel({singleSelect:!0,moveEditorOnEnterLikeOnTab:!0}),columns:[new Ext.grid.RowNumberer({header:"#"}),{header:"FormulationId",width:10,dataIndex:"FormulationId",sortable:!0,hidden:!0},{header:TEXT["Patient Type"],width:200,align:"left",dataIndex:"FormulationName",sortable:!0,hidden:!1},{header:"M",width:100,align:"right",dataIndex:"C0to4M",sortable:!0,hidden:!1,renderer:render_val,editor:new fm.NumberField({allowBlank:!0,allowNegative:!1,maxValue:1e7,selectOnFocus:!0})},{header:"F",width:100,align:"right",dataIndex:"C0to4F",sortable:!0,hidden:!1,renderer:render_val,editor:new fm.NumberField({allowBlank:!0,allowNegative:!1,maxValue:1e7,selectOnFocus:!0})},{header:"M",width:100,align:"right",dataIndex:"C5to14M",sortable:!0,hidden:!1,renderer:render_val,editor:new fm.NumberField({allowBlank:!0,allowNegative:!1,maxValue:1e7,selectOnFocus:!0})},{header:"F",width:100,align:"right",dataIndex:"C5to14F",sortable:!0,hidden:!1,renderer:render_val,editor:new fm.NumberField({allowBlank:!0,allowNegative:!1,maxValue:1e7,selectOnFocus:!0})},{header:"M",width:100,align:"right",dataIndex:"C15PlusM",sortable:!0,hidden:!1,renderer:render_val,editor:new fm.NumberField({allowBlank:!0,allowNegative:!1,maxValue:1e7,selectOnFocus:!0})},{header:"F",width:100,align:"right",dataIndex:"C15PlusF",sortable:!0,hidden:!1,renderer:render_val,editor:new fm.NumberField({allowBlank:!0,allowNegative:!1,maxValue:1e7,selectOnFocus:!0})},{header:TEXT["Pregnant Women"],width:120,align:"right",dataIndex:"PregnantWomen",sortable:!0,hidden:!1,renderer:render_val,editor:new fm.NumberField({allowBlank:!0,allowNegative:!1,maxValue:1e7,selectOnFocus:!0})}],viewConfig:{emptyText:TEXT["No rows to display"]},autoHeight:!0,align:"center",columnLines:!0,plugins:catGroup}),gridAdultRegimens.on("afteredit",saveAdultRegimens),gridAdultRegimens.on("beforeedit",handler_to_makeReadOnly),dsMasterStockData=new Ext.data.Store({id:"dsMasterStockDataId",proxy:new Ext.data.HttpProxy({url:baseUrl+"t_facility_level_monthlystatus_ext_server.php",method:"POST"}),baseParams:{action:"getMasterStockData",pUserId:pUserId,lang:lan},reader:new Ext.data.JsonReader({root:"results",totalProperty:"total",id:"id"},[{name:"ReportId",type:"int",mapping:"CFMStockId"},{name:"FacilityId",type:"int",mapping:"FacilityId"},{name:"MonthId",type:"int",mapping:"MonthId"},{name:"Year",type:"string",mapping:"Year"},{name:"CreatedBy",type:"string",mapping:"CreatedBy"},{name:"CreatedDt",type:"string",mapping:"CreatedDt"},{name:"LastUpdateBy",type:"string",mapping:"LastUpdateBy"},{name:"LastUpdateDt",type:"string",mapping:"LastUpdateDt"},{name:"LastSubmittedBy",type:"string",mapping:"LastSubmittedBy"},{name:"LastSubmittedDt",type:"string",mapping:"LastSubmittedDt"},{name:"StatusId",type:"int",mapping:"StatusId"},{name:"StatusName",type:"string",mapping:"StatusName"},{name:"AcceptedDt",type:"string",mapping:"AcceptedDt"},{name:"PublishedBy",type:"string",mapping:"PublishedBy"},{name:"PublishedDt",type:"string",mapping:"PublishedDt"}]),sortInfo:{field:"ReportId",direction:"ASC"}});var elePanelMaster=Ext.get("panelMaster");elePanelMaster.setVisibilityMode(Ext.Element.DISPLAY),clearMasterInfo(),elePanelMaster.hide(),dsMasterStockData.on("exception",function(t,e,a,o,d){alert(d.responseText)},this),dsMasterStockData.on("load",function(t){if(reportId=1==t.getCount()?t.data.items[0].data.ReportId:0,pReportId=reportId,reportId>0){elePanelMaster.show(),document.getElementById("txtReportIdDiv").innerHTML=TEXT["Report Id"]+" : "+reportId,pStatusId=t.data.items[0].data.StatusId,1==t.data.items[0].data.StatusId?(Ext.getCmp("submitid").setText(TEXT.Submit),jUserGroups[ENTRY_ADMIN]==ENTRY_ADMIN||jUserGroups[ENTRY_OPERATOR]==ENTRY_OPERATOR?(Ext.getCmp("submitid").enable(),bReadOnly=!0):(Ext.getCmp("submitid").disable(),bReadOnly=!1)):2==t.data.items[0].data.StatusId?(Ext.getCmp("submitid").setText(TEXT.Publish),jUserGroups[ENTRY_ADMIN]==ENTRY_ADMIN||jUserGroups[ENTRY_MANAGER]==ENTRY_MANAGER?(Ext.getCmp("submitid").enable(),bReadOnly=!0):jUserGroups[ENTRY_OPERATOR]==ENTRY_OPERATOR?(Ext.getCmp("submitid").disable(),bReadOnly=!1):Ext.getCmp("submitid").disable()):5==t.data.items[0].data.StatusId?jUserGroups[ENTRY_ADMIN]==ENTRY_ADMIN?(Ext.getCmp("submitid").disable(),bReadOnly=!1):(jUserGroups[ENTRY_MANAGER]==ENTRY_MANAGER||jUserGroups[ENTRY_OPERATOR]==ENTRY_OPERATOR)&&(Ext.getCmp("submitid").disable(),bReadOnly=!1):(Ext.getCmp("submitid").enable(),bReadOnly=!0);var e="#2A7907";if(1==t.data.items[0].data.StatusId)var e="#FF0000";else var e="#2A7907";document.getElementById("txtSubmitStatusDiv").innerHTML="<span style='font-size:2em;color:"+e+";'>"+t.data.items[0].data.StatusName+"</span>",""!=t.data.items[0].data.CreatedBy&&(document.getElementById("created-by").innerHTML="Created By : "+t.data.items[0].data.CreatedBy),""!=t.data.items[0].data.CreatedDt&&(document.getElementById("created-date").innerHTML=TEXT["Created Date"]+" : "+t.data.items[0].data.CreatedDt),""!=t.data.items[0].data.LastSubmittedBy&&(document.getElementById("submitted-by").innerHTML="Submitted By : "+t.data.items[0].data.LastSubmittedBy),""!=t.data.items[0].data.LastSubmittedDt&&(document.getElementById("submitted-date").innerHTML="Submitted Date : "+t.data.items[0].data.LastSubmittedDt),""!=t.data.items[0].data.LastUpdateBy&&(document.getElementById("updated-by").innerHTML="Last Upadated By : "+t.data.items[0].data.LastUpdateBy),""!=t.data.items[0].data.LastUpdateDt&&(document.getElementById("updated-date").innerHTML="Last Updated Date : "+t.data.items[0].data.LastUpdateDt),""!=t.data.items[0].data.PublishedBy&&(document.getElementById("published-by").innerHTML="Published By : "+t.data.items[0].data.PublishedBy),""!=t.data.items[0].data.PublishedDt&&(document.getElementById("published-date").innerHTML="Published Date : "+t.data.items[0].data.PublishedDt)}else clearMasterInfo(),elePanelMaster.hide();setBaseParams("pReportId",reportId),loadAllData()},this),dsArvData=new Ext.data.Store({id:"dsArvDataId",proxy:new Ext.data.HttpProxy({url:baseUrl+"t_facility_level_monthlystatus_ext_server.php",method:"POST"}),baseParams:{action:"getStockData",jUserId:jUserId,lang:lan},reader:new Ext.data.JsonReader({root:"results",totalProperty:"total",id:"id"},[{name:"ARVDataId",type:"int",mapping:"CFMStockStatusId"},{name:"FacilityId",type:"int",mapping:"FacilityId"},{name:"MonthId",type:"int",mapping:"MonthId"},{name:"Year",type:"string",mapping:"Year"},{name:"ItemGroupId",type:"int",mapping:"ItemGroupId"},{name:"ItemNo",type:"int",mapping:"ItemNo"},{name:"ItemSL",type:"int",mapping:"ItemSL"},{name:"ItemName",type:"string",mapping:"ItemName"},{name:"OpStock_A",type:"string",mapping:"OpStock_A"},{name:"OpStock_C",type:"string",mapping:"OpStock_C"},{name:"ReceiveQty",type:"string",mapping:"ReceiveQty"},{name:"DispenseQty",type:"string",mapping:"DispenseQty"},{name:"BeforeLastMonthDispensed",type:"int",mapping:"BeforeLastMonthDispensed"},{name:"LastMonthDispensed",type:"int",mapping:"LastMonthDispensed"},{name:"AdjustQty",type:"string",mapping:"AdjustQty"},{name:"AdjustReason",type:"string",mapping:"AdjustReason"},{name:"StockoutDays",type:"string",mapping:"StockoutDays"},{name:"ClStock_A",type:"string",mapping:"ClStock_A"},{name:"ClStock_C",type:"string",mapping:"ClStock_C"},{name:"MOS",type:"string",mapping:"MOS"},{name:"AMC_C",type:"string",mapping:"AMC_C"},{name:"AMC",type:"string",mapping:"AMC"},{name:"MaxQty",type:"string",mapping:"MaxQty"},{name:"OrderQty",type:"string",mapping:"OrderQty"},{name:"ActualQty",type:"string",mapping:"ActualQty"},{name:"OUReasonId",type:"int",mapping:"OUReasonId"},{name:"UserId",type:"int",mapping:"UserId"},{name:"LastEditTime",type:"string",mapping:"LastEditTime"},{name:"FormulationName",type:"string",mapping:"FormulationName"},{name:"ClStockSourceId",type:"int",mapping:"ClStockSourceId"},{name:"AmcChangeReasonId",type:"int",mapping:"AmcChangeReasonId"},{name:"StockOutReasonId",type:"int",mapping:"StockOutReasonId"}]),sortInfo:{field:"ItemSL",direction:"ASC"}}),dsArvData.on("load",function(){}),dsArvData.on("exception",function(t,e,a,o,d){alert(d.responseText)},this);var cboAdjustReason=new Ext.form.ComboBox({id:"cboAdjustId",displayField:"AdjustReason",valueField:"AdjustId",store:dsAdjustReason,mode:"local",allowBlank:!0,selectOnFocus:!0,triggerAction:"all",listeners:{focus:{fn:function(){}}}}),cboClStockSource=new Ext.form.ComboBox({id:"cboClStockSource",displayField:"SourceName",valueField:"ClStockSourceId",store:dsClStockSource,mode:"local",allowBlank:!0,selectOnFocus:!0,triggerAction:"all",listeners:{focus:{fn:function(){}}}}),cboAmcChangeReason=new Ext.form.ComboBox({id:"cboAmcChangeReason",displayField:"AmcChangeReasonName",valueField:"AmcChangeReasonId",store:dsAmcChangeReason,mode:"local",allowBlank:!0,selectOnFocus:!0,triggerAction:"all",listeners:{focus:{fn:function(){}}}}),cboOrderQtyChangeReason=new Ext.form.ComboBox({id:"cboOrderQtyChangeReason",displayField:"OUReason",valueField:"OUReasonId",store:dsOrderQtyChangeReason,mode:"local",allowBlank:!0,selectOnFocus:!0,triggerAction:"all",listeners:{focus:{fn:function(){}}}}),cboStockOutReason=new Ext.form.ComboBox({id:"cboStockOutReason",displayField:"StockOutReasonName",valueField:"StockOutReasonId",store:dsStockOutReason,mode:"local",allowBlank:!0,selectOnFocus:!0,triggerAction:"all",listeners:{focus:{fn:function(){}}}}),cboCountry=new Ext.form.ComboBox({id:"cboCountryId",displayField:"CountryName",valueField:"CountryId",disabled:!1,width:90,store:new Ext.data.ArrayStore({autoDestroy:!0,fields:["CountryId","CountryName","StartMonth","StartYear"],data:gCountries}),emptyText:TEXT["Select Country..."],mode:"local",allowBlank:!0,selectOnFocus:!0,triggerAction:"all",forceSelection:!0,listeners:{select:function(t,e){pRegionId=0,pDistrictId=0,pCountryId=e.get("CountryId"),dsRegion.setBaseParam("pCountryId",pCountryId),dsRegion.removeAll(!0),cboRegion.clearValue(),cboRegion.applyEmptyText(),dsRegion.load(),dsDistricts.removeAll(!0),cboDistrict.clearValue(),cboDistrict.applyEmptyText(),dsFacility.setBaseParam("pCountryId",pCountryId),setBaseParams("pCountryId",pCountryId),loadFacility()}}}),cboRegion=new Ext.form.ComboBox({id:"cboRegionId",displayField:"RegionName",valueField:"RegionId",disabled:!1,width:90,store:dsRegion,emptyText:TEXT["Select Region..."],mode:"local",allowBlank:!0,selectOnFocus:!0,triggerAction:"all",forceSelection:!0,listeners:{select:function(t,e){pDistrictId=0,pRegionId=e.get("RegionId"),dsFacility.setBaseParam("pRegionId",pRegionId),setBaseParams("pRegionId",pRegionId),dsDistricts.setBaseParam("pCountryId",pCountryId),dsDistricts.setBaseParam("pRegionId",pRegionId),dsDistricts.removeAll(!0),cboDistrict.clearValue(),cboDistrict.applyEmptyText(),dsDistricts.load(),loadFacility()}}}),cboDistrict=new Ext.form.ComboBox({id:"cboDistrictId",hiddenName:"hCboDistrictId",mode:"local",triggerAction:"all",emptyText:TEXT["Select District..."],fieldLabel:TEXT.District,displayField:"DistrictName",valueField:"DistrictId",anchor:"95%",allowBlank:!0,selectOnFocus:!0,store:dsDistricts,width:100,listeners:{select:function(t,e){pDistrictId=e.get("DistrictId"),dsFacility.setBaseParam("pDistrictId",pDistrictId),setBaseParams("pDistrictId",pDistrictId),loadFacility()}}}),cboOwnerType=new Ext.form.ComboBox({id:"cboOwnerTypeId",displayField:"OwnerTypeName",valueField:"OwnerTypeId",disabled:!1,width:90,store:new Ext.data.ArrayStore({autoDestroy:!0,fields:["OwnerTypeId","OwnerTypeName"],data:gOwnerTypeListArray}),emptyText:TEXT["Select Owner..."],mode:"local",allowBlank:!0,selectOnFocus:!0,triggerAction:"all",forceSelection:!0,listeners:{select:function(t,e){pOwnerTypeId=e.get("OwnerTypeId"),dsFacility.setBaseParam("pOwnerTypeId",pOwnerTypeId),setBaseParams("pOwnerTypeId",pOwnerTypeId),loadFacility()}}}),cboItemGroup=new Ext.form.ComboBox({id:"cboItemGroupId",displayField:"GroupName",valueField:"ItemGroupId",width:90,store:new Ext.data.ArrayStore({autoDestroy:!0,fields:["ItemGroupId","GroupName","bPatient","UserId"],data:gItemGroupListArry}),emptyText:TEXT["Select Group..."],mode:"local",allowBlank:!0,selectOnFocus:!0,triggerAction:"all",listeners:{select:function(t,e){pItemGroupId=e.get("ItemGroupId"),dsFacility.setBaseParam("pItemGroupId",pItemGroupId),setBaseParams("pItemGroupId",pItemGroupId),bPatient=e.get("bPatient"),pFacilityId=0,pFLevelId=0,gRowIndex=0,loadFacility()}}});gridArvData=new Ext.grid.EditorGridPanel({id:"gridArvDataId",style:"text-align:left",stripeRows:!0,store:dsArvData,clicksToEdit:1,region:"fit",width:"100%",loadMask:{msg:TEXT["Loading data."],enabled:!0},sm:new Ext.grid.RowSelectionModel({singleSelect:!0,moveEditorOnEnterLikeOnTab:!0}),columns:[{header:"ARVDataId",width:70,dataIndex:"ARVDataId",sortable:!1,hidden:!0},{header:"FacilityId",width:70,align:"left",dataIndex:"FacilityId",sortable:!1,hidden:!0},{header:"MonthId",width:70,align:"left",dataIndex:"MonthId",sortable:!1,hidden:!0},{header:"Year",width:70,align:"left",dataIndex:"Year",sortable:!1,hidden:!0},{header:"ItemGroupId",width:70,align:"left",dataIndex:"ItemGroupId",sortable:!0,hidden:!0},{header:"ItemNo",width:70,align:"left",dataIndex:"ItemNo",sortable:!1,hidden:!0},{header:"SL#",width:50,align:"center",dataIndex:"ItemSL",sortable:!0,hidden:!1},{header:TEXT.Item+"<br/>&nbsp",tooltip:TEXT["Item Name"],width:170,align:"left",dataIndex:"ItemName",sortable:!1,hidden:!1},{header:"OBL(c)<br/>(C)",tooltip:"Opening Balance",width:70,align:"right",dataIndex:"OpStock_C",sortable:!1,hidden:!0,renderer:render_val},{header:TEXT.OBL+"<br/>(A)",tooltip:TEXT["Opening Balance"]+" (OBL) -> (A)",width:70,align:"right",dataIndex:"OpStock_A",sortable:!1,hidden:!1,renderer:function(t){return Ext.util.Format.number(t,"0,000")},editor:new fm.NumberField({allowBlank:!0,allowNegative:!0,maxValue:999999999,selectOnFocus:!0})},{header:TEXT.Received+"<br/>(B)",tooltip:TEXT["Received Quantity"]+" -> (B)",width:70,align:"right",dataIndex:"ReceiveQty",sortable:!1,hidden:!1,renderer:function(t){return Ext.util.Format.number(t,"0,000")},editor:new fm.NumberField({allowBlank:!0,allowNegative:!1,maxValue:999999999,selectOnFocus:!0})},{header:TEXT.Dispensed+"<br/>(C)",tooltip:TEXT["Dispensed Quantity"]+" -> (C)",width:70,align:"right",dataIndex:"DispenseQty",sortable:!1,hidden:!1,renderer:function(t){return Ext.util.Format.number(t,"0,000")},editor:new fm.NumberField({allowBlank:!0,allowNegative:!1,maxValue:999999999,selectOnFocus:!0})},{header:"Last<br/>Month Dispensed",width:70,align:"right",dataIndex:"lastMonthDispensed",sortable:!1,hidden:!0},{header:"Before Last<br/>Month Dispensed",width:70,align:"right",dataIndex:"BeforeLastMonthDispensed",sortable:!1,hidden:!0},{header:TEXT.Adjusted+"<br/>(&#177;D)",tooltip:TEXT["Adjusted Quantity"]+" -> (&#177;D)",width:70,align:"right",dataIndex:"AdjustQty",sortable:!1,hidden:!1,editor:new fm.NumberField({allowBlank:!0,allowNegative:!0,maxValue:999999999,selectOnFocus:!0,listeners:{blur:function(){}}})},{header:TEXT.Adjust+"<br/>"+TEXT.Reason,tooltip:TEXT["Adjusting Reason"],width:100,align:"left",dataIndex:"AdjustId",sortable:!1,hidden:!1,editor:cboAdjustReason,renderer:function(t,e,a){void 0!=t&&a.set("AdjustReason",t);var o,d,i=a.get("AdjustReason");return o=dsAdjustReason.find("AdjustId",i),-1!=o&&(d=dsAdjustReason.getAt(o).data.AdjustReason),("None"==d?"":d)||""}},{header:TEXT["Stock Out"]+"<br/>"+TEXT.Days,tooltip:TEXT["Stock Out Days"],width:70,align:"right",dataIndex:"StockoutDays",sortable:!1,hidden:!1,renderer:render_val,editor:new fm.NumberField({allowBlank:!0,allowNegative:!1,selectOnFocus:!0})},{header:TEXT["Stock Out Reason"],tooltip:TEXT["Stock Out Reason"],width:100,align:"left",dataIndex:"StockOutReasonId",sortable:!1,hidden:!1,editor:cboStockOutReason,renderer:function(t,e,a){void 0!=t&&a.set("StockOutReasonId",t);var o,d,i=a.get("StockOutReasonId");return o=dsStockOutReason.find("StockOutReasonId",i),-1!=o&&(d=dsStockOutReason.getAt(o).data.StockOutReasonName),("None"==d?"":d)||""}},{header:TEXT["CBL(c)"]+"<br/>(F=A+C+D+E)",tooltip:TEXT["Closing Balance Calculated"],width:70,align:"right",dataIndex:"ClStock_C",sortable:!1,hidden:!0,renderer:function(t,e){return e.css="arv-cblc",0==t?"":Ext.util.Format.number(t,"0,000")}},{header:TEXT["Closing Balance"]+"<br/>(E)",tooltip:TEXT["Closing Balance"]+" -> (E)",width:70,align:"right",dataIndex:"ClStock_A",sortable:!1,hidden:!1,editor:new fm.NumberField({allowBlank:!0,allowNegative:!1,maxValue:2999999997,selectOnFocus:!0,listeners:{blur:function(){}}})},{header:TEXT["CL Stock"]+"<br/>"+TEXT.Source,tooltip:TEXT["Closing balance stock source"],width:100,align:"left",dataIndex:"ClStockSourceId",sortable:!1,hidden:!0,editor:cboClStockSource,renderer:function(t,e,a){void 0!=t&&a.set("ClStockSourceId",t);var o,d,i=a.get("ClStockSourceId");return o=dsClStockSource.find("ClStockSourceId",i),-1!=o&&(d=dsClStockSource.getAt(o).data.SourceName),("None"==d?"":d)||""}},{header:TEXT["AMC Calculated"]+"<br/>(F)",tooltip:TEXT["Average Monthly Calculation (AMC_C) Calculated"]+" -> (F=(P2C+C)/3)",width:70,align:"right",dataIndex:"AMC_C",sortable:!1,hidden:!0,renderer:function(t){return Ext.util.Format.number(t,"0,000")},editor:new fm.NumberField({allowBlank:!0,allowNegative:!1,maxValue:8999999991,selectOnFocus:!0,listeners:{blur:function(){}}})},{header:TEXT.AMC+"<br/>(F)",tooltip:TEXT["Average Monthly Calculation"]+" (AMC) -> (F=(P2C+C)/3)",width:70,align:"right",dataIndex:"AMC",sortable:!1,hidden:!1,renderer:function(t){return Ext.util.Format.number(t,"0,000")},editor:new fm.NumberField({allowBlank:!0,allowNegative:!1,maxValue:8999999991,selectOnFocus:!0,listeners:{blur:function(){}}})},{header:TEXT["AMC Change"]+"<br/>"+TEXT.Reason,tooltip:TEXT["AMC change reason"],width:100,align:"left",dataIndex:"AmcChangeReasonId",sortable:!1,hidden:!0,editor:cboAmcChangeReason,renderer:function(t,e,a){void 0!=t&&a.set("AmcChangeReasonId",t);var o,d,i=a.get("AmcChangeReasonId");return o=dsAmcChangeReason.find("AmcChangeReasonId",i),-1!=o&&(d=dsAmcChangeReason.getAt(o).data.AmcChangeReasonName),("None"==d?"":d)||""}},{header:TEXT.MOS+"<br/>(G)",tooltip:TEXT["Month Of Supply (MOS)"]+" -> (G=E/F)",width:70,align:"right",dataIndex:"MOS",sortable:!1,hidden:!1,renderer:function(t,e){return e.css="arv-mos",Ext.util.Format.number(t,"0.0")}},{header:TEXT["Max Qty"]+" <br/>(H)",tooltip:TEXT["Maximum Quantity"]+" -> (H=F*3)",width:70,align:"right",dataIndex:"MaxQty",sortable:!1,hidden:!1,renderer:function(t,e){return e.css="arv-maxqty",Ext.util.Format.number(t,"0,000")}},{header:TEXT["Order Qty"]+" <br/>(I)",tooltip:TEXT["Order Quantity"]+" -> (I=H-E)",width:70,align:"right",dataIndex:"OrderQty",sortable:!1,hidden:!1,renderer:function(t,e){return e.css="arv-orderqty",0>t?"":Ext.util.Format.number(t,"0,000")}},{header:TEXT["Actual Order"]+" <br/>"+TEXT.Qty+"(J)",tooltip:TEXT["Actual Order Quantity"]+" -> (J=H-E&#177;X)",width:70,align:"right",dataIndex:"ActualQty",sortable:!1,hidden:!1,renderer:function(t){return 0>t?"":Ext.util.Format.number(t,"0,000")},editor:new fm.NumberField({allowBlank:!0,allowNegative:!0,maxValue:8999999991,selectOnFocus:!0})},{header:TEXT["Order Qty"]+"<br/>"+TEXT["Update Reason"],tooltip:TEXT["Order quantity change reason"],width:100,align:"left",dataIndex:"OUReasonId",sortable:!1,hidden:!1,editor:cboOrderQtyChangeReason,renderer:function(t,e,a){void 0!=t&&a.set("OUReasonId",t);var o,d,i=a.get("OUReasonId");return o=dsOrderQtyChangeReason.find("OUReasonId",i),-1!=o&&(d=dsOrderQtyChangeReason.getAt(o).data.OUReason),("None"==d?"":d)||""}},{header:"UserId",width:70,align:"left",dataIndex:"UserId",sortable:!1,hidden:!0,editor:new fm.NumberField({allowBlank:!0,allowNegative:!1,maxValue:999999999})},{header:TEXT.Formulation,width:70,align:"left",dataIndex:"FormulationName",sortable:!1,hidden:!0}],viewConfig:{forceFit:!0,emptyText:"No rows to display",getRowClass:function(t){return t.data.OpStock_A+t.data.ReceiveQty+t.data.AdjustQty-t.data.ClStock_A!=t.data.DispenseQty?"clsinvalid":void 0}},width:"100%",buttonAlign:"right",autoHeight:!0,align:"center",columnLines:!0,bbar:new Ext.PagingToolbar({pageSize:20,store:dsArvData,displayInfo:!0,displayMsg:TEXT.Displaying+"  {0} - {1} "+TEXT.of+" {2}",emptyMsg:TEXT["No Records found"],items:[]})}),gridArvData.getSelectionModel().on("rowdeselect",saveGridRow),gridArvData.on("afteredit",saveTheCell),gridArvData.on("beforeedit",handler_to_makeReadOnly),Ext.EventManager.on(window,"beforeunload",function(){}),tabArvdata=new Ext.TabPanel({id:"tabArvdataId",activeTab:0,width:"100%",autoHeight:!0,frame:!0,region:"center",defaults:{autoScroll:!0},closable:!0,resizeTabs:!0,minTabWidth:170,bodyStyle:"padding:0px; margin:0px; border:0px; background-color:#ffffff;",enableTabScroll:!0,items:[{title:TEXT["Stock Information"],disabled:!1,id:"tabItemArvData",width:"100%",autoHeight:!0,bodyStyle:"padding:0px; margin:0px; border:0px; background-color:#DFE8F6;",items:[gridArvData]},{title:TEXT["Patient Overview"],id:"tabItemPatientOverviewId",width:"100%",autoHeight:!0,hideMode:"display",style:{display:"block"},bodyStyle:"padding:0px; margin:0px; border:0px; background-color:#DFE8F6;",items:[gridPatientOverview]},{title:TEXT["Patient by Regimen"],disabled:!1,id:"tabItemAdultRegimens",width:"100%",autoHeight:!0,bodyStyle:"padding:0px; margin:0px; border:0px; background-color:#DFE8F6;",items:[gridAdultRegimens]}],listeners:{tabchange:function(t){selectedTab=t.getActiveTab().id,"tabItemArvData"==selectedTab?gridArvData.getView().refresh():"tabItemPatientOverviewId"==selectedTab?gridPatientOverview.getView().refresh():"tabItemAdultRegimens"==selectedTab&&gridAdultRegimens.getView().refresh()}}}),tbarMaster=new Ext.Toolbar({items:[{xtype:"label",text:"Report Id:"},{xtype:"label",id:"lblReportId"},"-","-",{xtype:"label",text:"Created By:"},{xtype:"label",id:"lblCreatedBy"},"-","-",{xtype:"label",text:"Created Date:"},{xtype:"label",id:"lblCreatedDt"},"-","-",{xtype:"label",text:"Changed By:"},{xtype:"label",id:"lblLastUpdateBy"},"-","-",{xtype:"label",text:"Changed Date:"},{xtype:"label",id:"lblLastUpdateDt"},"-","-",{xtype:"label",text:"Submitted By:"},{xtype:"label",id:"lblLastSubmittedBy"},"-","-",{xtype:"label",text:"Submitted Date:"},{xtype:"label",id:"lblLastSubmittedDt"}]}),tbar2=new Ext.Toolbar({items:[{xtype:"label",text:"Country:"},{xtype:"tbspacer",width:10},cboCountry,{xtype:"tbspacer",width:50},{xtype:"label",text:"Product Group:"},{xtype:"tbspacer",width:10},cboItemGroup]}),tbar=new Ext.Toolbar({items:[{tooltip:TEXT["Show/Hide Facility"],enableToggle:!0,icon:baseUrl+"images/show-hide.png",toggleHandler:showHideFacility},"-","-",{xtype:"label",text:TEXT.Country+":"},cboCountry,"-","-",{xtype:"label",text:TEXT.Region+":"},cboRegion,"-","-",{xtype:"label",text:TEXT.District+":"},cboDistrict,"-","-",{xtype:"label",text:TEXT.Owner+":"},cboOwnerType,"-","-",{xtype:"label",text:TEXT.Month+":"},{xtype:"combo",hiddenName:"hCboMonthId",id:"cboMonthId",emptyText:TEXT["Select Month..."],fieldLabel:TEXT.Month,mode:"local",store:dsMonth,allowBlank:!0,selectOnFocus:!0,displayField:"MonthName",valueField:"MonthId",triggerAction:"all",width:100,listeners:{select:function(t,e){pMonthId=e.get("MonthId"),currentDate.setMonth(pMonthId-1),dsFacility.setBaseParam("pMonthId",pMonthId),setBaseParams("pMonthId",pMonthId),loadFacility()}}},"-","-",{xtype:"label",text:TEXT.Year+":"},{xtype:"combo",id:"cboYearId",hiddenName:"hCboYearId",mode:"local",triggerAction:"all",emptyText:TEXT["Select Year..."],fieldLabel:TEXT.Year,displayField:"YearName",valueField:"YearId",anchor:"95%",allowBlank:!0,selectOnFocus:!0,store:dsYear,width:100,listeners:{select:function(t,e){pYearId=e.get("YearId"),currentDate.setYear(pYearId),dsFacility.setBaseParam("pYearId",pYearId),setBaseParams("pYearId",pYearId),loadFacility()}}},"-","-",{text:TEXT.Print,icon:baseUrl+"images/print-button.png",handler:printHtml},"-","-",{text:TEXT.Excel,icon:baseUrl+"images/excel-button.png",handler:printExcel},"-","-",{text:TEXT.PDF,icon:baseUrl+"images/pdf-button.png",handler:printPdf},"-","-",{tooltip:TEXT.Unpublish,icon:baseUrl+"images/un-publish.png",handler:makeUnpublished}]});var panelCombo=new Ext.Panel({id:"panelComboId",frame:!0,height:40,layout:"auto",region:"north",items:[tbar]}),panelMaster=new Ext.Panel({id:"panelComboId",frame:!0,height:40,layout:"auto",region:"north",items:[tbarMaster]}),postArray=[{}],panelSubmit=new Ext.Panel({id:"panelSubmitId",frame:!0,height:75,layout:"auto",items:[{xtype:"button",id:"submitid",text:TEXT.Submit,width:200,height:60,style:"margin:0 auto;font-size:25px",handler:function(){changeBsubmittedInMaster()}}]}),gridFacility=new Ext.grid.EditorGridPanel({id:"grid-facility-id",store:dsFacility,autoHeight:!0,style:"text-align:left",sm:new Ext.grid.RowSelectionModel({singleSelect:!0}),columns:[{header:"Facility ID",width:150,dataIndex:"FacilityId",sortable:!0,hidden:!0},{header:"CFMStockId",width:150,dataIndex:"CFMStockId",sortable:!0,hidden:!0},{header:TEXT.Facility,width:160,align:"left",dataIndex:"FacilityName",sortable:!0,hidden:!1,renderer:multilineColumn},{header:"District",width:110,align:"left",dataIndex:"DistrictName",sortable:!0,hidden:!0},{xtype:"actioncolumn",header:TEXT.New+"/<br/>"+TEXT.Edit,align:"center",width:80,items:[{getClass:function(t,e,a){return 0!=a.get("CFMStockId")&&(this.items[0].tooltip="Report Published",5==a.get("StatusId"))?"EditEntry":0==a.get("CFMStockId")&&(this.items[0].tooltip="New Entry",jUserGroups[ENTRY_OPERATOR]==ENTRY_OPERATOR)?"NewEntry":void 0},handler:function(t,e){var a=dsFacility.getAt(e);vFacilityId=a.data.FacilityId,vFacility=a.data.FacilityName,pFacilityId=a.data.FacilityId,pFLevelId=a.data.FLevelId,setBaseParams("pFacilityId",pFacilityId),gridFacility.getSelectionModel().selectRow(e,!0),pFacilityCount=a.data.FacilityCount,0!=a.data.CFMStockId?loadMaster():(gRowIndex=e,createReport())}},{icon:baseUrl+"images/i_trans.png"},{getClass:function(t,e,a){return 1!=a.get("StatusId")&&2!=a.get("StatusId")||(this.items[1].tooltip="Delete Record",jUserGroups[ENTRY_OPERATOR]!=ENTRY_OPERATOR)?void 0:"DeleteReocord"},handler:function(t,e){var a=dsFacility.getAt(e);vFacilityId=a.data.FacilityId,vFacility=a.data.FacilityName,pFacilityId=a.data.FacilityId,pFLevelId=a.data.FLevelId,setBaseParams("pFacilityId",pFacilityId),a.data.StatusId>0&&a.data.StatusId<=5&&deleteRecord()}},{getClass:function(t,e,a){if(1==a.get("StatusId")){if(this.items[1].tooltip="Submit",jUserGroups[ENTRY_OPERATOR]==ENTRY_OPERATOR)return"Submit-S"}else if(2==a.get("StatusId")&&(this.items[1].tooltip="Publish",jUserGroups[ENTRY_MANAGER]==ENTRY_MANAGER))return"Submit-P"},handler:function(t,e){var a=dsFacility.getAt(e);vFacilityId=a.data.FacilityId,vFacility=a.data.FacilityName,pFacilityId=a.data.FacilityId,pFLevelId=a.data.FLevelId,setBaseParams("pFacilityId",pFacilityId),gRowIndex=e,pStatusId=a.data.StatusId,a.data.StatusId>0&&a.data.StatusId<5&&changeBsubmittedInMaster()}}]}],view:new Ext.grid.GroupingView({forceFit:!0,groupTextTpl:'{text} ({[values.rs.length]} {[values.rs.length > 1 ? "Facilities" : "Facility"]})',getRowClass:function(t,e){var a=function(t){return t%2==0?!0:!1};return 1==a(e)?"evenRow":0==a(e)?"oddRow":void 0}}),viewConfig:{},plugins:[searchfield],align:"center",columnLines:!0,tbar:new Ext.Toolbar({items:[]}),bbar:new Ext.PagingToolbar({pageSize:25,store:dsFacility,displayInfo:!0,displayMsg:TEXT.Displaying+"  {0} - {1} "+TEXT.of+" {2}",emptyMsg:TEXT["No Records found"],items:[],listeners:{beforechange:function(){dsFacility.setBaseParam("pMonthId",pMonthId),dsFacility.setBaseParam("pYearId",pYearId),dsFacility.setBaseParam("pCountryId",pCountryId),dsFacility.setBaseParam("pItemGroupId",pItemGroupId)}}})});gridFacility.getSelectionModel().on("rowselect",function(t,e){clearMasterInfo(),gRowIndex=e;var a=dsFacility.getAt(e);vFacilityId=a.get("FacilityId"),initMonthId=parseInt(a.get("StartMonthId")),initYearId=parseInt(a.get("StartYearId")),supplyFrom=parseInt(a.get("SupplyFrom")),startDate=new Date(initYearId,initMonthId-1),startManthName=startDate.getMonthName(),vFacility=a.get("FacilityName"),pFacilityId=a.get("FacilityId"),pFLevelId=a.get("FLevelId"),setBaseParams("pFacilityId",pFacilityId),pFacilityCount=a.get("FacilityCount"),loadMaster()}),panelCombo.render("panelCombo"),gridFacility.render("grid-facility"),tabArvdata.render("tabArvdata"),panelSubmit.render("panelSubmit");var countryStore=Ext.getCmp("cboCountryId").getStore();cboCountry.setValue(countryStore.data.items[0].data.CountryId);var cRecord=countryStore.data.items[0];cboCountry.fireEvent("select",cboCountry,cRecord),jQuery("#submitid button").attr("id","btn-sub-acc-pub"),pCountryId=1,cboCountry.setValue(pCountryId),dsRegion.setBaseParam("pCountryId",pCountryId),dsRegion.load(),dsFacility.setBaseParam("pCountryId",pCountryId),pOwnerTypeId=2,cboOwnerType.setValue(pOwnerTypeId),dsFacility.setBaseParam("pOwnerTypeId",pOwnerTypeId),Ext.getCmp("submitid").disable()});